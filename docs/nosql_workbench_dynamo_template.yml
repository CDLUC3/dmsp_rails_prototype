---
AWSTemplateFormatVersion: '2010-09-09'

Description: 'DynamoDB seed template for NoSQL Workbench'

Resources:
  # ----------------------------------------------
  # DynamoDB polymorphic table for DMPs
  #   See: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dynamodb-table.html
  # ----------------------------------------------
  DynamoTable:
    Type: 'AWS::DynamoDB::Table'
    Properties:
      # The base table's Partition key and Sort Key define both the DMP ID and version
      # There are 3 potential variants of these keys:
      # PK - PROVENANCE#dmptool,      SK - PROFILE                       <--- Provenance info
      # PK - DMP#doi:10.48321/D1M30K, SK - VERSION#latest                <--- Latest version
      # PK - DMP#doi:10.48321/D1M30K, SK - VERSION#2022-02-18T12:30:25Z  <--- Historical version

      KeySchema:
        - AttributeName: 'PK'
          KeyType: 'HASH'
        - AttributeName: 'SK'
          KeyType: 'RANGE'

      AttributeDefinitions:
        # DMPHub attribute that stores the provenance/DMP id (see above)
        - AttributeName: 'PK'
          AttributeType: 'S'
        # DMPHub attribute that stores the provenance profile or the DMP version (see above)
        - AttributeName: 'SK'
          AttributeType: 'S'
        # DMPHub attribute that stores the mod date as YYYY-MM-DD for fast date range retrievals
        - AttributeName: 'dmphub_modification_day'
          AttributeType: 'S'
        # The originating provenance system's ID for the DMP
        - AttributeName: 'dmphub_provenance_identifier'
          AttributeType: 'S'
        # The featured flag
        - AttributeName: 'dmproadmap_featured'
          AttributeType: 'S'

      StreamSpecification:
        StreamViewType: 'NEW_IMAGE'

      BillingMode: 'PAY_PER_REQUEST'
      TableClass: 'STANDARD'
      ContributorInsightsSpecification:
        Enabled: false
      # Determine cost before enabling
      PointInTimeRecoverySpecification:
        PointInTimeRecoveryEnabled: false
